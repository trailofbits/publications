FROM ubuntu:20.04

# Configure timezone so that tzdata dependency does not require user input to
# configure.
ENV TZ=America/New_York
RUN ln -snf /usr/share/zoneinfo/$TZ /etc/localtime && echo $TZ > /etc/timezone

# Pin to SQLite install to vulnerable version.
RUN apt-get update && \
    apt-get install -y build-essential wget git vim tclsh

WORKDIR /sqlite3
RUN git clone git://git.launchpad.net/ubuntu/+source/sqlite3 src
WORKDIR /sqlite3/src
RUN git checkout applied/3.31.1-4ubuntu0.3
WORKDIR /sqlite3/build-optimized
RUN ../src/configure --enable-shared && make
WORKDIR /sqlite3/build-unoptimized
ENV CFLAGS="-g -O0"
RUN ../src/configure --enable-shared && make

COPY ./ /poc
WORKDIR /poc

ENV C_INCLUDE_PATH=/sqlite3/build-optimized \
    LD_FLAGS="-L/sqlite3/build-optimized/.libs"
RUN make
